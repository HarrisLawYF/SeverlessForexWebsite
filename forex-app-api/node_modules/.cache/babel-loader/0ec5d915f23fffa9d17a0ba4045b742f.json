{"ast":null,"code":"import \"source-map-support/register\";\nimport { getCurrencyRates } from \"../libs/currency-data\"; //const parallel = require(\"map-parallel\");\n\nvar async = require(\"async\"); //const os = require(\"os\");\n\n\nexport async function calculateMaximumProfit(body) {\n  return await generateCurrencyGraph(body);\n}\nvar min = -9999999; //This is like a virtual class\n\n/*var edge = {\r\n    id: 0,\r\n    src_bank: 0,\r\n    dest_bank: 0,\r\n    rate: 0,\r\n    extra_cost: 0\r\n};*/\n\nvar graph = {\n  edges: [],\n  banks: 0,\n  rates: 0,\n  create: function () {\n    for (var i = 0; i < this.rates; i++) {\n      // Initialize the graph with empty nodes\n      var new_edge = {\n        src_bank: 0,\n        dest_bank: 0\n      };\n      this.edges.push(new_edge);\n    }\n\n    return this;\n  }\n};\n\nfunction calculateMoneyWithCurrencyRate(local_currency, rate, extra_cost) {\n  var result = local_currency * rate;\n  result = result * ((100 - extra_cost) / 100);\n  return result;\n}\n\nfunction Forex(graph, src_bank) {\n  var V = graph.banks;\n  var E = graph.rates;\n  var dist = [];\n  var bridges = []; // Step 1: Initialize distances from src to all other vertices as INFINITE negative\n\n  for (var z = 0; z < V; ++z) {\n    dist[z] = min;\n    bridges[z] = [src_bank];\n  } //Start with 1 dollar\n\n\n  dist[src_bank] = 1;\n\n  for (var i = 1; i < 10; ++i) {\n    for (var j = 0; j < E; ++j) {\n      var u = graph.edges[j].src_bank;\n      var v = graph.edges[j].dest_bank;\n      var extra_cost = graph.edges[j].extra_cost;\n      var rate = graph.edges[j].rate;\n      var result = calculateMoneyWithCurrencyRate(dist[u], rate, extra_cost);\n\n      if (dist[u] != min && result > dist[v]) {\n        dist[v] = result;\n        var new_route = bridges[u].slice(0);\n        bridges[v] = new_route;\n        bridges[v].push(v);\n      }\n    }\n  } //printArr(dist, bridges, V);\n\n\n  return {\n    dist,\n    bridges\n  };\n} // A utility function used to print the solution\n\n/*function printArr(dist, bridges, V)\r\n{\r\n    console.log(\"Vertex Distance from Source\");\r\n    for (var i = 0; i < V; ++i){\r\n        console.log(i + \"\\t\\t\" + dist[i]);\r\n        console.log(bridges[i]);\r\n        console.log(\"--------------\");\r\n    }\r\n\r\n}*/\n\n\nasync function buildGraph(link, currency, position, callback) {\n  const promise = new Promise(function (resolve, reject) {\n    link.id = position;\n    link.src_bank = currency[position].src_id;\n    link.dest_bank = currency[position].dest_id;\n    link.rate = getCurrencyRates(\"SGD\", \"MYR\");\n    console.log(link.rate);\n    console.log(\"-----------------------------\");\n    link.extra_cost = 0;\n  });\n  return callback(null, promise);\n}\n\nasync function generateCurrencyGraph(data) {\n  var new_graph = {\n    edges: [],\n    banks: data.total_currencies,\n    rates: data.total_rates\n  };\n  new_graph = graph.create.call(new_graph);\n  const promise = new Promise(function (resolve, reject) {\n    async.map(new_graph.edges, function (edge, callback) {\n      buildGraph(edge, data.currencies, new_graph.edges.indexOf(edge), callback);\n    }, function (err, results) {\n      if (err) {\n        console.log(err);\n      }\n\n      new_graph.edges = results;\n      var result = Forex(new_graph, 0);\n\n      if (result != null) {\n        resolve(result);\n      } else {\n        reject(\"Maximum profit not calculated\");\n      }\n    });\n  });\n  return promise;\n}","map":{"version":3,"sources":["D:\\Users\\Harris\\Desktop\\Projects\\forex-website\\forex-app-api\\libs\\bellman-ford-lib.js"],"names":["getCurrencyRates","async","require","calculateMaximumProfit","body","generateCurrencyGraph","min","graph","edges","banks","rates","create","i","new_edge","src_bank","dest_bank","push","calculateMoneyWithCurrencyRate","local_currency","rate","extra_cost","result","Forex","V","E","dist","bridges","z","j","u","v","new_route","slice","buildGraph","link","currency","position","callback","promise","Promise","resolve","reject","id","src_id","dest_id","console","log","data","new_graph","total_currencies","total_rates","call","map","edge","currencies","indexOf","err","results"],"mappings":"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","sourcesContent":["import { getCurrencyRates } from \"../libs/currency-data\";\r\n//const parallel = require(\"map-parallel\");\r\nvar async = require(\"async\");\r\n//const os = require(\"os\");\r\n\r\nexport async function calculateMaximumProfit(body) {\r\n    return await generateCurrencyGraph(body);\r\n}\r\n\r\n\r\nvar min = -9999999;\r\n\r\n//This is like a virtual class\r\n/*var edge = {\r\n    id: 0,\r\n    src_bank: 0,\r\n    dest_bank: 0,\r\n    rate: 0,\r\n    extra_cost: 0\r\n};*/\r\n\r\nvar graph = {\r\n    edges:[],\r\n    banks: 0,\r\n    rates: 0,\r\n    create: function(){\r\n        for (var i = 0; i < this.rates; i++) {\r\n            // Initialize the graph with empty nodes\r\n            var new_edge = {src_bank:0,dest_bank:0};\r\n            this.edges.push(new_edge);\r\n        }\r\n        return this;\r\n    },\r\n};\r\n\r\nfunction calculateMoneyWithCurrencyRate(local_currency, rate, extra_cost){\r\n    var result = local_currency * rate;\r\n    result = result*((100-extra_cost)/100);\r\n    return result;\r\n}\r\n\r\nfunction Forex(graph, src_bank)\r\n{\r\n    var V = graph.banks;\r\n    var E = graph.rates;\r\n    var dist = [];\r\n    var bridges = [];\r\n\r\n    // Step 1: Initialize distances from src to all other vertices as INFINITE negative\r\n    for (var z = 0; z < V; ++z){\r\n        dist[z] = min;\r\n        bridges[z] = [src_bank];\r\n    }\r\n\r\n    //Start with 1 dollar\r\n    dist[src_bank] = 1;\r\n\r\n    for (var i = 1; i < 10; ++i) {\r\n        for (var j = 0; j < E; ++j) {\r\n            var u = graph.edges[j].src_bank;\r\n            var v = graph.edges[j].dest_bank;\r\n            var extra_cost = graph.edges[j].extra_cost;\r\n            var rate = graph.edges[j].rate;\r\n            var result = calculateMoneyWithCurrencyRate(dist[u],rate,extra_cost);\r\n            if (dist[u] != min && result > dist[v]){\r\n                dist[v] = result;\r\n                var new_route = bridges[u].slice(0);\r\n                bridges[v] = new_route;\r\n                bridges[v].push(v);\r\n            }\r\n        }\r\n    }\r\n    //printArr(dist, bridges, V);\r\n    return {dist, bridges};\r\n}\r\n\r\n// A utility function used to print the solution\r\n/*function printArr(dist, bridges, V)\r\n{\r\n    console.log(\"Vertex Distance from Source\");\r\n    for (var i = 0; i < V; ++i){\r\n        console.log(i + \"\\t\\t\" + dist[i]);\r\n        console.log(bridges[i]);\r\n        console.log(\"--------------\");\r\n    }\r\n\r\n}*/\r\n\r\nasync function buildGraph(link,currency,position,callback){\r\n    const promise = new Promise(function(resolve, reject) {\r\n        link.id = position;\r\n        link.src_bank = currency[position].src_id;\r\n        link.dest_bank = currency[position].dest_id;\r\n        link.rate = getCurrencyRates(\"SGD\", \"MYR\");\r\n        console.log(link.rate);\r\n        console.log(\"-----------------------------\");\r\n        link.extra_cost = 0;\r\n    });\r\n    \r\n    return callback(null,promise);\r\n}\r\n\r\nasync function generateCurrencyGraph(data){\r\n    var new_graph = {edges:[],banks:data.total_currencies,rates:data.total_rates};\r\n    new_graph = graph.create.call(new_graph);\r\n\r\n    const promise = new Promise(function(resolve, reject) {\r\n        async.map(new_graph.edges, function(edge, callback) {\r\n            buildGraph(edge,data.currencies,new_graph.edges.indexOf(edge),callback);\r\n        }, function (err, results) {\r\n            if (err){\r\n                console.log(err);\r\n            }\r\n            new_graph.edges = results;\r\n            var result = Forex(new_graph,0);\r\n            if(result!=null){\r\n                resolve(result);\r\n            } else{\r\n                reject(\"Maximum profit not calculated\");\r\n            }\r\n        });\r\n    });\r\n    return promise;\r\n}"]},"metadata":{},"sourceType":"module"}